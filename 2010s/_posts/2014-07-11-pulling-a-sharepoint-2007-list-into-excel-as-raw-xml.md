---
layout: post
title: Pulling a Sharepoint 2007 list into Excel as Raw XML
---

<p>I recently had a need to mash-up some data from a SharePoint 2007 list in an Excel document I was working on. I already knew that I could work with SharePoint 2007 data in Excel by using the following instructions from Microsoft:</p>  <blockquote>   <ol>     <li>Do one the following on a SharePoint site:</li>   </ol>    <h6>Windows SharePoint Services 3.0</h6>    <ol>     <li>If your list is not already open, click its name on the Quick Launch. If the name of your list doesn't appear, click <b>View All Site Content</b>, and then click the name of your list. </li>      <li>On the <b>Actions</b> menu <img title="Actions menu" border="0" alt="Actions menu" src="http://officeimg.vo.msecnd.net/en-us/files/819/809/ZA010100999.gif" />, click <b>Export to Spreadsheet</b>. </li>      <li>If you are prompted to confirm the operation, click <b>OK</b>.</li>   </ol>    <h6>Windows SharePoint Services 2.0</h6>    <ol>     <li>If your list is not already open, click <b>Documents and Lists</b>, and then click the name of your list. </li>      <li>On the page that displays the list, under <b>Actions</b>, click <b>Export to spreadsheet.</b></li>   </ol>    <ol>     <li>In the <b>File Download</b> dialog box, click <b>Open</b>. </li>      <li>If you are prompted whether to enable data connections on your computer, click <b>Enable</b> if you believe the connection to the data on the SharePoint site is safe to enable. </li>      <li>Do one of the following:</li>   </ol>    <ul>     <li>If no workbook is open, Excel creates a new blank workbook and inserts the data as a table on a new worksheet. </li>      <li>If a workbook is open, do the following in the <b>Import Data</b> dialog box that appears:         <ol>         <li>Under <b>Select how you want to view this data in your workbook</b>, click <b>Table</b>, <b>PivotTable Report</b>, or<b>PivotChart and PivotTable Report</b>. </li>          <li>Under <b>Where do you want to put the data</b>, click <b>Existing worksheet</b>, <b>New worksheet</b>, or <b>New workbook</b>.</li>       </ol>     </li>   </ul>    <p>If you click <b>Existing worksheet</b>, click the cell where you want to place the upper-left corner of the list.</p>    <ol start="start">     <li>Click <b>OK</b>.</li>   </ol> </blockquote>  <p><a title="http://office.microsoft.com/en-us/excel-help/import-data-from-a-sharepoint-list-HA010131473.aspx" href="http://office.microsoft.com/en-us/excel-help/import-data-from-a-sharepoint-list-HA010131473.aspx">http://office.microsoft.com/en-us/excel-help/import-data-from-a-sharepoint-list-HA010131473.aspx</a></p>  <p> </p>  <p>That’s all very well, but in my case I had an existing spreadsheet with quite a few tables and an existing excel model. I didn’t want to go through these gyrations. Isn’t there some way to just get the data right off the list as a web page?</p>  <p>Yes. Enter the “Import XML data” feature in Excel. MS Offers the following following guidance for getting XML data from a web service:</p>  <blockquote>   <h4>Import XML data from a Web service</h4>    <p>To do the following procedure, you must have access to a server that is running pnSTS11. A default installation of pnSTS11 provides a data retrieval service for connecting to data in SharePoint lists. A SharePoi<a name="_GoBack"></a>nt site administrator can install the Microsoft Office Web Parts and Components to add additional data retrieval services for Microsoft SQL Server and Microsoft Business Solutions. The installation program for Microsoft Office Web Parts and Components is available from the <a href="http://office.microsoft.com/en-us/excel-help/redir/XT001032664.aspx?CTT=5&amp;origin=HP001042351">Downloads on Microsoft Office Online</a>.</p>    <ol>     <li>On the <b>Data</b> menu, point to <b>Import External Data</b>, and then click <b>Import Data</b>. </li>      <li>Do one of the following:</li>   </ol>    <p><a href="http://office.microsoft.com/en-us/excel-help/"><img title="Show" border="0" alt="Show" src="http://officeimg.vo.msecnd.net/en-us/files/785/945/ZA079005000.gif" />Open an existing data source</a></p>    <p><a href="http://office.microsoft.com/en-us/excel-help/"><img title="Show" border="0" alt="Show" src="http://officeimg.vo.msecnd.net/en-us/files/785/945/ZA079005000.gif" />Create and open a new data source connection</a></p>    <ol>     <li>Select one of the following options:</li>   </ol>    <ul>     <li><b>XML list in existing worksheet</b></li>   </ul>    <p>The contents of the XML data file are imported into an XML list in the existing worksheet at the specified cell location.</p>    <ul>     <li><b>XML list in new worksheet</b></li>   </ul>    <p>The contents of the file are imported into an XML list in a new worksheet starting at cell A1.</p>    <ol start="start">     <li>If the XML data file does not refer to a schema, then Excel will infer the schema from the XML data file. </li>      <li>To control the behavior of XML data, such as data binding, format, and layout, click <b>Properties</b> which displays the <b>XML Map properties</b> dialog box. For example, existing data in a mapped range will be overwritten when you import data by default, but you can change this.</li>   </ol> </blockquote>  <p><a title="http://office.microsoft.com/en-us/excel-help/import-xml-data-HP001042351.aspx#BMimport_xml_data_from_a_web_service" href="http://office.microsoft.com/en-us/excel-help/import-xml-data-HP001042351.aspx#BMimport_xml_data_from_a_web_service">http://office.microsoft.com/en-us/excel-help/import-xml-data-HP001042351.aspx#BMimport_xml_data_from_a_web_service</a></p>  <p> </p>  <p>But how to get the URL to call for the XML data? The following link holds the key:</p>  <p><a href="http://{0}/_vti_bin/owssvr.dll?Cmd=Display&amp;List={1}&amp;View={2}&amp;XMLDATA=TRUE">http://{0}/_vti_bin/owssvr.dll?Cmd=Display&amp;List={1}&amp;View={2}&amp;XMLDATA=TRUE</a></p>  <p>You have to replace {0} with your site URL and the {1} with your GUID for the list ID on SharePoint and {2} with the view GUID. How to get these? Well the easiest way (I think) is to go to your list, then select the view you want. Click view dropdown and select “Modify this view.” This will open the link to the screen where you can modify that view. The URL in the browser should have a View and List value. I stripped the %7B and %7D off as those are the { and } respectively. You don’t need to use a view and can omit that completely if you want to connect directly to the list. But I found I normally wanted to just get a certain view or I wanted to create a special view just for this activity.</p>  <p>Regardless, you can now follow the auto prompts to get the data into a spreadsheet. You can also open the developer tab and dive into the XML itself (see the MS link above for more instructions) and drag and drop the fields to other locations. Now when you get the data it will put it wherever you bound it.</p>  <p>By default it will dump it into a table and will include the schema items which you don’t need. You can open the Developer tab, select “Source” in the XML section and then just deselect the ns2 : Schema element. It will stop syncing those fields and you’ll have to clean up your table to get rid of them. I was able to rename the columns etc as needed, but since this is a read only feed I was typically using it to calculate other columns so I frequently stick with the ows_* columns that are the defaults for the data element.</p>  <p>Screenshot of the XML section from Developer tab in Excel:</p>  <p><img alt="XML Refresh Data" src="http://officeimg.vo.msecnd.net/en-us/files/376/918/ZA102921552.jpg" /></p>  <p> </p>  <p>Once I figured out I needed to find the XML import stuff for Excel, I was able to find lots of articles on it online to help. The following was my favorite and links to a lot of other ones.</p>  <p><a title="http://blogs.msdn.com/b/kaevans/archive/2009/05/01/getting-xml-data-from-a-sharepoint-list-the-easy-way.aspx" href="http://blogs.msdn.com/b/kaevans/archive/2009/05/01/getting-xml-data-from-a-sharepoint-list-the-easy-way.aspx">http://blogs.msdn.com/b/kaevans/archive/2009/05/01/getting-xml-data-from-a-sharepoint-list-the-easy-way.aspx</a></p>